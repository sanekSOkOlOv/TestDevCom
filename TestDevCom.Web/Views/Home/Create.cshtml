@model TestDevCom.Web.Models.Announcement
@using TestDevCom.Web.Enums
@using TestDevCom.Web.Models
@{
    ViewData["Title"] = "Створити оголошення";
}

<h2>@ViewData["Title"]</h2>

<form asp-action="Create">
    <div class="form-group">
        <label for="Category">Категорія</label>
        <select asp-for="Category" class="form-control" id="category">
            @foreach (var category in Enum.GetValues(typeof(Category)))
            {
                <option value="@((int)category)">@category</option>
            }
        </select>
    </div>

    <div class="form-group">
        <label for="SubCategory">Підкатегорія</label>
        <select asp-for="SubCategory" class="form-control" id="subcategory">
            <option>-- Виберіть категорію --</option>
        </select>
    </div>

    <div class="form-group">
        <label for="Title">Заголовок</label>
        <input asp-for="Title" class="form-control" />
    </div>

    <div class="form-group">
        <label for="Description">Опис</label>
        <textarea asp-for="Description" class="form-control"></textarea>
    </div>

    <button type="submit" class="btn btn-primary">Створити</button>
</form>

@section Scripts {
    <script>
        document.getElementById("category").addEventListener("change", async function () {
            const selectedCategory = this.value;
            const subcategorySelect = document.getElementById("subcategory");

            // Очистити підкатегорії
            subcategorySelect.innerHTML = "<option disabled selected>Завантаження...</option>";

            try {
               fetch(`https://localhost:44316/api/Category/subcategories/byid/${selectedCategory}`);

                const data = await response.json();

                subcategorySelect.innerHTML = ""; // Очистити

                if (data.length === 0) {
                    subcategorySelect.innerHTML = "<option disabled selected>Немає підкатегорій</option>";
                    return;
                }

                // Заповнити новими
                data.forEach(function (sub) {
                    const option = document.createElement("option");
                    option.value = sub;
                    option.text = sub;
                    subcategorySelect.appendChild(option);
                });
            } catch (error) {
                console.error("Помилка отримання підкатегорій:", error);
                subcategorySelect.innerHTML = "<option disabled selected>Помилка завантаження</option>";
            }
        });
    </script>
}