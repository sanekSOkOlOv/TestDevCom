@model TestDevCom.Web.Models.Announcement
@using TestDevCom.Web.Enums
@using TestDevCom.Web.Models
@{
    ViewData["Title"] = "Створити оголошення";
}

<h2>@ViewData["Title"]</h2>

<form asp-action="Create">
    <div class="form-group">
        <label for="Category">Категорія</label>
        <select asp-for="Category" class="form-control" id="category">
            @foreach (var category in Enum.GetValues(typeof(Category)))
            {
                <option value="@((int)category)">@category.ToString()</option>
            }
        </select>
    </div>

    <div class="form-group">
        <label for="SubCategory">Підкатегорія</label>
        <select asp-for="SubCategory" class="form-control" id="subcategory">
            <option>-- Виберіть категорію --</option>
        </select>
    </div>

    <div class="form-group">
        <label for="Title">Заголовок</label>
        <input asp-for="Title" class="form-control" />
    </div>

    <div class="form-group">
        <label for="Description">Опис</label>
        <textarea asp-for="Description" class="form-control"></textarea>
    </div>

    <div class="form-group">
        <label for="Status">Статус</label>
        <select asp-for="Status" class="form-control" id="status">
            <option value="true">Активне</option>
            <option value="false">Неактивне</option>
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Створити</button>
</form>

@section Scripts {


    <script>

        function formatEnumValue(value) {
            return value
                .replace(/_/g, ' ')
                .replace(/([a-zа-яґєії])([A-ZА-ЯҐЄІЇ])/g, '$1 $2');
        }

        document.addEventListener("DOMContentLoaded", function () {
            const categorySelect = document.getElementById("category");

            for (let option of categorySelect.options) {
                option.text = formatEnumValue(option.text);
            }
        });

        document.getElementById("category").addEventListener("change", async function () {
            const selectedCategory = this.value;
            const subcategorySelect = document.getElementById("subcategory");

            subcategorySelect.innerHTML = "<option disabled selected>Завантаження...</option>";

            try {
                const response = await fetch(`${apiBaseUrl}api/Category/subcategories/byid/${selectedCategory}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                subcategorySelect.innerHTML = ""; 

                if (data.length === 0) {
                    subcategorySelect.innerHTML = "<option disabled selected>Немає підкатегорій</option>";
                    return;
                } 

                data.forEach(function (sub) {
                    const option = document.createElement("option");
                    option.value = sub;
                    option.text = formatEnumValue(sub);
                    subcategorySelect.appendChild(option);
                });
            } catch (error) {
                console.error("Помилка отримання підкатегорій:", error);
                subcategorySelect.innerHTML = "<option disabled selected>Помилка завантаження</option>";
            }
        });
    </script>
}
